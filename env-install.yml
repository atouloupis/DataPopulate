---
- name: Setup app
  hosts: localhost
  gather_facts: no

  vars_prompt :
    - name: scalewayAPIsKey
      prompt: "What is your scaleway API"
      private: no

    - name: scalewayAPIpKey
      prompt: "What is your scaleway API"
      private: no
      
    - name: adminName
      prompt: "What is your admin account name"
      private: no
    
    - name: adminPassword
      prompt: "What is your admin password"
      private: yes
      encrypt: "sha512_crypt"
      confirm: yes
      salt_size: 7
      
    
  tasks:

  - debug:
      msg: Begin setup

  - name: got to root folder
    shell: cd /home
    
  - name: git install
    shell: apt get install git

  - name: git clone
    shell: git clone https://github.com/atouloupis/Masternodes.git

  - name: install nodejs
    shell: apt-get install nodejs

  - name: install npm
    shell: apt-get install npm

  - name: update and upgrade apt packages
    apt:
      update_cache=yes
      state=latest
      upgrade=yes

  - name: get mongo key
    shell: wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -
    
  - name: get mongo source
    shell: echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list

  - name: update and upgrade apt packages
    apt:
      update_cache=yes
      state=latest
      upgrade=yes

  - name: install mongo
    shell: sudo apt-get install -y mongodb-org

  - name: start mongo
    shell: sudo systemctl start mongod


  - name: store admin variables
    local_action :
      module: copy
      content: '{{adminName}}:{{adminPassword}}'
      dest: /root/MAsternodes/users.htpasswd

  - name: cron walletsInfosUpdate
    lineinfile:
      path: /etc/cron.d/sysstat
      line: "*/20 * * * * root node /root/Masternodes/src/walletsManagement/walletsInfosUpdate.js"
      insertafter: EOF
      
  - name: cron coinGekoUpdate
    lineinfile:
      path: /etc/cron.d/sysstat
      line: "*/10 * * * * root node /root/Masternodes/src/marketInfo/coinGekoUpdate.js"
      insertafter: EOF

  - name: restart crontab
    shell: /etc/init.d/cron force-reload
    


//create DB masternode

 
//install mongodb